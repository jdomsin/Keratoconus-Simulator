<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Keratoconus Simulator V9</title>
    <style>
        /* Base styles */
        html {
            font-size: 16px;
        }

        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.5;
        }

        .simulator-container {
            background-color: #ffffff;
            padding: 50px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 900px;
            margin-top: 20px;
            box-sizing: border-box;
            overflow: hidden; /* Keep this */

            display: flex;
            flex-direction: column;
            align-items: center; /* Center flex items */
        }

        .text-display {
            position: relative;
            margin-bottom: 70px; /* Base margin */
            /* min-height set by JS */
            display: block;
            width: 100%; /* Use full available width */
            box-sizing: border-box;
            transition: transform 0.2s ease-out, margin-left 0.2s ease-out; /* Add margin transition */
            transform-origin: center center;
            transform: scale(1.0); /* Base Scale */
            margin-left: 0; /* Base margin */
        }

        .main-text, .ghost-text {
            position: relative;
            z-index: 1;
            font-weight: bold;
            margin: 0;
            white-space: nowrap;
            transition: font-size 0.1s ease-out, transform 0.05s linear, opacity 0.05s linear, color 0.1s linear;
            display: block;
            box-sizing: border-box;
            text-align: center; /* Keep text centered in its block */
        }

        .ghost-text {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            pointer-events: none;
        }


        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
        }

        /* Control Group & Label styles remain the same */
        .control-group { display: flex; flex-direction: column; align-items: stretch; width: 100%; box-sizing: border-box; }
        .control-group label { margin-bottom: 5px; font-size: 0.9rem; color: #555; }
        .control-group input[type="range"], .control-group select { width: 100%; padding: 8px 5px; box-sizing: border-box; }
        .value-display { font-weight: bold; color: #007bff; min-width: 40px; text-align: right; margin-left: 10px; font-size: 0.9rem; }
        .label-container { display: flex; justify-content: space-between; width: 100%; align-items: center; }

        /* --- Responsive Adjustments --- */

        @media (max-width: 992px) {
            html { font-size: 15px; }
            .simulator-container { padding: 40px; max-width: 800px; }
            .text-display { margin-bottom: 60px; }
        }

         @media (max-width: 768px) {
             html { font-size: 14px; }
             .simulator-container { padding: 30px 20px; }
         }


        @media (max-width: 600px) {
            body { padding: 10px; }
            .simulator-container {
                width: 95%;
                padding: 25px 10px;
                margin-top: 10px;
            }
            .text-display {
                margin-bottom: 50px;
                transform: scale(0.8);
                /* Negative margin to pull left: (1 - 0.8) / 2 = 0.1 -> 10% of parent */
                /* Try percentage based on element width reduction */
                /* margin-left: -10%; */ /* Adjust if needed */
            }
            .controls { max-width: 100%; gap: 15px; }
            .control-group label, .value-display { font-size: 0.85rem; }
        }

        @media (max-width: 480px) {
             html { font-size: 13px; }
             .simulator-container { padding: 20px 10px; }
             .text-display {
                 margin-bottom: 45px;
                 transform: scale(0.6);
                 /* Negative margin: (1 - 0.6) / 2 = 0.2 -> 20% */
                 margin-left: -20%; /* ** ADDED NEGATIVE MARGIN ** */
             }
        }

         @media (max-width: 380px) {
             html { font-size: 12px; }
             .simulator-container { padding: 20px 5px; }
              .text-display {
                 transform: scale(0.5);
                 margin-bottom: 40px;
                  /* Negative margin: (1 - 0.5) / 2 = 0.25 -> 25% */
                 margin-left: -25%; /* ** ADDED NEGATIVE MARGIN ** */
             }
         }

    </style>
</head>
<body>

    <!-- Container and Controls HTML remain the same as V8 -->
    <div class="simulator-container">
        <div class="text-display" id="text-display">
            <h1 class="main-text" id="main-text">Keratoconus</h1>
            <h1 class="ghost-text" id="ghost-text">Keratoconus</h1>
        </div>

        <div class="controls">
             <!-- Font Size Slider -->
            <div class="control-group">
                 <div class="label-container">
                    <label for="font-size-slider">Font Size:</label>
                    <span class="value-display" id="font-size-value">5rem</span>
                 </div>
                <input type="range" id="font-size-slider" name="fontsize" min="0" max="8" value="4" step="1">
            </div>

            <!-- Offset Slider -->
            <div class="control-group">
                 <div class="label-container">
                    <label for="offset-slider">Offset Distance (px):</label>
                    <span class="value-display" id="offset-value">5</span>
                 </div>
                <input type="range" id="offset-slider" name="offset" min="0" max="20" value="5" step="1">
            </div>

            <!-- Angle Slider -->
            <div class="control-group">
                <div class="label-container">
                    <label for="angle-slider">Direction (degrees):</label>
                    <span class="value-display" id="angle-value">220</span>
                </div>
                <input type="range" id="angle-slider" name="angle" min="0" max="360" value="220" step="1">
            </div>

            <!-- Opacity Slider -->
            <div class="control-group">
                <div class="label-container">
                    <label for="opacity-slider">Ghost Opacity:</label>
                    <span class="value-display" id="opacity-value">0.20</span>
                 </div>
                <input type="range" id="opacity-slider" name="opacity" min="0" max="1" value="0.2" step="0.01">
            </div>

            <!-- Color Selector -->
            <div class="control-group">
                 <div class="label-container">
                     <label for="color-selector">Text Color:</label>
                 </div>
                 <select id="color-selector" name="color">
                    <option value="#000000" selected>Black</option>
                    <option value="#FF0000">Red</option>
                    <option value="#0000FF">Blue</option>
                    <option value="#008000">Green</option>
                    <option value="#800080">Purple</option>
                    <option value="#FFA500">Orange</option>
                    <option value="#808080">Gray</option>
                    <option value="#A52A2A">Brown</option>
                 </select>
            </div>
        </div>
    </div>

    <!-- JavaScript remains the same as V8 -->
     <script>
        // --- Get DOM Elements ---
        const mainText = document.getElementById('main-text');
        const ghostText = document.getElementById('ghost-text');
        const textDisplay = document.getElementById('text-display');
        const fontSizeSlider = document.getElementById('font-size-slider');
        const offsetSlider = document.getElementById('offset-slider');
        const angleSlider = document.getElementById('angle-slider');
        const opacitySlider = document.getElementById('opacity-slider');
        const colorSelector = document.getElementById('color-selector');
        const fontSizeValueDisplay = document.getElementById('font-size-value');
        const offsetValueDisplay = document.getElementById('offset-value');
        const angleValueDisplay = document.getElementById('angle-value');
        const opacityValueDisplay = document.getElementById('opacity-value');

        // --- Combined Update Function ---
        function updateVisuals() {
            // Read values from controls
            const fontSizeSliderValue = parseInt(fontSizeSlider.value); // Value from 0 to 8
            const offset = parseFloat(offsetSlider.value);
            const angleDegrees = parseFloat(angleSlider.value);
            const opacity = parseFloat(opacitySlider.value);
            const selectedColor = colorSelector.value;

            // --- Calculate Actual Font Size ---
            const actualFontSizeRem = fontSizeSliderValue + 1; // Map slider 0-8 to 1rem-9rem

            // Update display values
            fontSizeValueDisplay.textContent = actualFontSizeRem + 'rem';
            offsetValueDisplay.textContent = offset;
            angleValueDisplay.textContent = angleDegrees;
            opacityValueDisplay.textContent = opacity.toFixed(2);

            // --- Update Font Size ---
            mainText.style.fontSize = actualFontSizeRem + 'rem';
            ghostText.style.fontSize = actualFontSizeRem + 'rem';

            // --- Dynamic Min Height Adjustment ---
             if (textDisplay.minHeightTimeout) {
                 clearTimeout(textDisplay.minHeightTimeout);
             }
            textDisplay.minHeightTimeout = setTimeout(() => {
                 const computedStyle = getComputedStyle(mainText);
                 const currentFontSizePx = parseFloat(computedStyle.fontSize);
                 const currentLineHeight = parseFloat(computedStyle.lineHeight) || (currentFontSizePx * 1.2);
                 textDisplay.style.minHeight = (currentLineHeight * 1.2) + 'px';
            }, 0);

            // --- Update Ghost Position ---
            const angleRadians = angleDegrees * (Math.PI / 180);
            const dx = offset * Math.cos(angleRadians);
            const dy = offset * Math.sin(angleRadians);
            ghostText.style.transform = `translate(${dx.toFixed(2)}px, ${dy.toFixed(2)}px)`;

            // --- Update Ghost Opacity ---
            ghostText.style.opacity = opacity;

            // --- Update Colors ---
            mainText.style.color = selectedColor;
            ghostText.style.color = selectedColor;
        }

        // --- Initial Setup ---
        fontSizeSlider.addEventListener('input', updateVisuals);
        offsetSlider.addEventListener('input', updateVisuals);
        angleSlider.addEventListener('input', updateVisuals);
        opacitySlider.addEventListener('input', updateVisuals);
        colorSelector.addEventListener('change', updateVisuals);

        setTimeout(updateVisuals, 0);

    </script>

</body>
</html>